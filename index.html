<html>
<head>
<title>INFO 3300 - Project 2</title>
<link href="https://fonts.googleapis.com/css?family=Alegreya|Alegreya+Sans" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script src="https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"></script>

<style>

body { font-family: 'Century Gothic', Calibri, sans-serif; font-size: 14; background-color: #F9F9DE}
h1 { 
    display: block;
    font-size: 2em;
    margin-top: 0.67em;
    margin-bottom: 0.67em;
    margin-left: 0;
    margin-right: 0;
    font-weight: bold;
    text-align: center;
    font-size: 40px;
}
h2 { 
    display: block;
    font-size: 1.3em;
    margin-top: 0.67em;
    margin-bottom: 1.5em;
    margin-left: 0;
    margin-right: 0;
    text-align: start;
}
form {
  text-align: center;
  font-size: 1.2em;
}

input[type=button], input[type=submit], input[type=reset] {
    background-color: #3D9970;
    border: none;
    color: white;
    padding: 5px 25px;
    text-decoration: none;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 10px; 
    font-size: 1em;
}

.toolTip {
    position: absolute;
    display: none;
    min-width: 60px;
    height: auto;
    background: none repeat scroll 0 0 #ffffff;
    border: 1px solid #660000;
    padding: 5px;
    text-align: center;
}

.team_stat:hover{
    opacity: 0.75;
}

#team_stat_0:hover ~ #team_stat_text_0{
    opacity: 1;
}

#team_stat_1:hover ~ #team_stat_text_1{
    opacity: 1;
}

#team_stat_2:hover ~ #team_stat_text_2{
    opacity: 1;
}

#team_stat_3:hover ~ #team_stat_text_3{
    opacity: 1;
}

#team_stat_4:hover ~ #team_stat_text_4{
    opacity: 1;
}

#team_stat_5:hover ~ #team_stat_text_5{
    opacity: 1;
}

.switch_button:hover{
    opacity: 0.75;
}

.switch_button:active{
    opacity: 0.5;
}

</style>
</head>
<body>

<h1> 
<img src="pics/logo.png" alt="" style="width:400px;height:150px;">
<img src="pics/team_builder.png" alt="" style="width:600px;height:150px;">
</h1> 
</br>
<h2>
With over 700 Pokemon, it has become increasingly difficult to make an in-game or competitive team. This application is designed to make that process a little easier.  You can choose a subset of regions corresponding to which games you own. You can also pick the type of team you want. Stat total corresponds to the highest sum of all of the stats. Attack corresponds to the max of Special Attack and Attack. Defense corresponds to the average of Defense, Special Defense, and HP. Mixed corresponds to the top 2 of each of the preceding categories. Lastly, random is just random as expected. Beyond this, you can even limit your search by choosing whether you want to include Mega evolutions and Legendary Pokemon. Hover over a Pokemon to see their stats. Click on “Switch” if you want to go to the next optimal Pokemon. 
</br> </br>
Note for Competitive Play: The teams returned are not necessarily allowed according to competitive rules. It is recommended that you click away Pokemon until the team is allowed.
</h2>
<div id="user_inputs">
<form id="mainForm" onsubmit="submitForm(); return false;">
  Region:
  <input type="checkbox" name="Gen" value="1" checked> Kanto (Gen 1) &nbsp &nbsp
  <input type="checkbox" name="Gen" value="2"> Johto (Gen 2) &nbsp &nbsp
  <input type="checkbox" name="Gen" value="3"> Hoenn (Gen 3) &nbsp &nbsp
  <input type="checkbox" name="Gen" value="4"> Sinnoh (Gen 4) &nbsp &nbsp
  <input type="checkbox" name="Gen" value="5"> Unova (Gen 5) &nbsp &nbsp
  <input type="checkbox" name="Gen" value="6"> Kalos (Gen 6) &nbsp &nbsp
  </br>
  </br>
  Team Type:
  <input type="radio" name="Team" value="total" checked> Stat Total &nbsp &nbsp
  <input type="radio" name="Team" value="attack"> Attack &nbsp &nbsp
  <input type="radio" name="Team" value="defense"> Defensive &nbsp &nbsp
  <input type="radio" name="Team" value="mixed"> Mixed &nbsp &nbsp
  <input type="radio" name="Team" value="random"> Random &nbsp &nbsp
  </br>
  </br>
  Include Legendary Pokemon:
  <input type="radio" name="Legend" value="yes" checked> Yes &nbsp &nbsp
  <input type="radio" name="Legend" value="no"> No &nbsp &nbsp
  </br>
  </br>
  Include Mega or Primal Evolutions:
  <input type="radio" name="Mega" value="yes" checked> Yes &nbsp &nbsp
  <input type="radio" name="Mega" value="no"> No &nbsp &nbsp
  </br>
  </br>
  <input type="submit" value="Go!" >
</form>
</div>

<div id="pokemon_images" align="center">
<svg id="pokemon_display" align="center" width="1400" height="300">
</svg>
</div>


<h1>
Team Type Effectiveness: 
</h1>
<h2>
Every Pokemon has a corresponding type. Some Pokemon have 2 types. The first plot below shows the percentage of Pokemon corresponding to each type of either all Pokemon or the subset in the region specified. 
</h2>

<div id="user_inputs_2">
<form id="form2">
  Regions for Type Comparison: &nbsp &nbsp
  <input onClick="submitForm2();" type="radio" name="R" value="all" checked> All Regions &nbsp &nbsp
  <input onClick="submitForm2();" type="radio" name="R" value="subset"> Subset of Regions Checked Above &nbsp &nbsp
  </br>
</form>
</div>

<div id "plots_group2" align="center">
<svg id="type_counts" width="700" height="700"></svg>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp

<div id="option">
    <input name="updateButton" 
           type="button" 
           value="Offense" 
           id = "offensebutton"
           style = "background-color:gray"
           onclick="buttonClickOff()" />
    <input name="updateButton" 
           type="button" 
           value="Defense" 
           id= "defensebutton"
           onclick="buttonClickDef()" />
</div>
<svg id="team_type_chart" style="border: solid #ccc 1px;" width="1050" height="400"></svg>
</div>

<h2>
Here is another plot, gotta explain it, look Pokemon move recommendations blah blah blah.
</h2>

<div id "plots_group3" align="center">
<svg id="recommended_moves" style="border: solid #ccc 1px;" width="1500" height="1000"></svg>
</div>



<div id="our names and disclaimer">
Disclaimer: The Pokemon name, trademark and franchise are all Copyright to Nintendo, Pokemon, Creatures Inc and Game Freak inc. This application is a fan project and thus claims no rights or association with aforementioned companies or their products. Please support Pokemon by purchasing the official Games, Television Series, Manga, Merchandise, and so forth. If they don't make money then nobody would ever use an application like this. 
</div>

<script>
var typeToColor = {"Grass": "#006622", "Poison": "#7C0774", "Fire":"#D16B31", "Flying":"#B47EC1",
"Dragon":"#5104D7", "Water":"#0000ff", "Bug": "#96A646", "Normal":"#A9A97E", "Electric":"#FED400",
"Ground":"#CBAA4F", "Fairy":"#F7A3F7", "Fighting":"#930909", "Psychic":"#FE0088", "Rock":"#8D7533",
"Steel":"#7C7C7C", "Ice":"#41F7F7", "Ghost":"#440159", "Dark":"#614D14"};
var typeLst = ["Normal", "Fire", "Water", "Electric", "Grass", "Ice", "Fighting", "Poison", "Ground",
"Flying", "Psychic", "Bug", "Rock", "Ghost", "Dragon", "Dark", "Steel", "Fairy"];

var colorDictDef = {"0":"#FFFFFF","0.25":"#F2CCCE", "0.5":"#E5999E","1":"#D8666D","2":"#CB333D","4":"#BF000D"} //darker = more vulnerable

var colorDict = {"4":"#1C8901","2":"#49A033", "1":"#76B866","0.5":"#A4CF99","0.25":"#D1E7CC","0":"#FFFFFF"}; //for heatmap; darker= more damage

var teamToDamage = {}; //pokemon and the type they're good against - higher number - more damage
var teamToWeakness = {}; //pokemon and the type they're weak against - higher number = more vulnerable

var regionToIdx = {};
for (i=0; i < typeLst.length; i++){
    regionToIdx[typeLst[i]] = i;
}
var regions = [true,false,false,false,false,false];
var teamType = "total";
var legend = true;
var mega = true;
var total1 = []; var total2 = []; var total3 = []; var total4 = []; var total5 = []; var total6 = [];
var atk1 = []; var atk2 = []; var atk3 = []; var atk4 = []; var atk5 = []; var atk6 = [];
var def1 = []; var def2 = []; var def3 = []; var def4 = []; var def5 = []; var def6 = [];
var total = [];
var atk = [];
var def = [];
var team = [];
var nextTeam = [];
var nextAttack = []; // only needed for Mixed
var nextDef = []; // only needed for Mixed
var nextTotal = []; // only needed for Mixed
var idUsed = []; // only needed for Mixed
var typeToEff = {}; // give it a type, returns dict by type and value = effectiveness
var useAllRegionsType = true;
var typeToMoves = {};
var data = [];

var parseStatsRow = function(row) {
    var l = false;
    var isMega = false;
    if (row["Legendary"]=="True"){
        l = true;
    }
    idStr = row["#"];
    if (row["Name"].includes("CharizardMega")){
        if (row["Name"].includes("X")){
            idStr = idStr + "-mega-x";
            row["Name"] = "Mega Charizard X";
        }
        else{
            idStr = idStr + "-mega-y";
            row["Name"] = "Mega Charizard Y";
        }
        isMega = true;
    }
    else if (row["Name"].includes("MewtwoMega")){
        if (row["Name"].includes("X")){
            idStr = idStr + "-mega-x";
            row["Name"] = "Mega Mewtwo X";
        }
        else{
            idStr = idStr + "-mega-y";
            row["Name"] = "Mega Mewtwo Y";
        }
        isMega = true;
    }
    else if (row["Name"].includes("Mega") && !row["Name"].includes("Meganium")){
        idStr = idStr + "-mega";
        row["Name"] = "Mega " + row["Name"].split("Mega")[0];
        isMega = true;
    }
    else if (row["Name"].includes("Primal")){
        idStr = idStr + "-primal";
        row["Name"] = "Primal " + row["Name"].split("Primal")[0];
        isMega = true;
    }
    else if (row["Name"].includes("Deoxys")){
        if (row["Name"].includes("Normal")){
            row["Name"] = "Deoxys (Normal)";
            idStr = idStr + "-normal";
        }
        else if (row["Name"].includes("Attack")){
            row["Name"] = "Deoxys (Attack)";
            idStr = idStr + "-attack";
        }
        else if (row["Name"].includes("Defense")){
            row["Name"] = "Deoxys (Defense)";
            idStr = idStr + "-defense";

        }
        else if (row["Name"].includes("Speed")){
            row["Name"] = "Deoxys (Speed)";
            idStr = idStr + "-speed";

        }
    }
    else if (row["Name"].includes("Wormadam")){
        if (row["Name"].includes("Plant")){
            row["Name"] = "Wormadam Plant";
            idStr = idStr + "-plant";
        }
        else if (row["Name"].includes("Sandy")){
            row["Name"] = "Wormadam Sandy";
            idStr = idStr + "-sandy";
        }
        else if (row["Name"].includes("Trash")){
            row["Name"] = "Wormadam Trash";
            idStr = idStr + "-trash";
        }
    }
    else if (row["Name"].includes("Rotom")){
        if (row["Name"].includes("Heat")){
            idStr = idStr + "-heat";
        }
        else if (row["Name"].includes("Wash")){
            row["Name"] = "Rotom Wash";
            idStr = idStr + "-wash";
        }
        else if (row["Name"].includes("Frost")){
            row["Name"] = "Rotom Frost";
            idStr = idStr + "-frost";
        }
        else if (row["Name"].includes("Fan")){
            row["Name"] = "Rotom Fan";
            idStr = idStr + "-fan";
        }
        else if (row["Name"].includes("Mow")){
            row["Name"] = "Rotom Mow";
            idStr = idStr + "-mow";
        }
    }
    else if (row["Name"].includes("Giratina")){
        if (row["Name"].includes("Altered")){
            row["Name"] = "Giratina (Altered)";
            idStr = idStr + "-altered";
        }
        else{
            row["Name"] = "Giratina (Origin)";
            idStr = idStr + "-origin";
        }
    }
    else if (row["Name"].includes("Shaymin")){
        if (row["Name"].includes("Land")){
            row["Name"] = "Shaymin Land";
            idStr = idStr + "-land";
        }
        else{
            row["Name"] = "Shaymin Sky";
            idStr = idStr + "-sky";
        }
    }
    else if (row["Name"].includes("Tornadus") || row["Name"].includes("Thundurus") || row["Name"].includes("Landorus")){
        if (row["Name"].includes("Incarnate")){
            row["Name"] = row["Name"].split("Incarnate")[0]+" (Incarnate)";
            idStr = idStr + "-incarnate";
        }
        else{
            row["Name"] = row["Name"].split("Therian")[0]+" (Therian)";
            idStr = idStr + "-therian";
        }
    }
    else if (row["Name"].includes("Kyurem")){
        if (row["Name"].includes("Black")){
            row["Name"] = "Black Kyurem";
            idStr = idStr + "-black";
        }
        else if (row["Name"].includes("White")){
            row["Name"] = "White Kyurem";
            idStr = idStr + "-white";
        }
    }
    else if (row["Name"].includes("Keldeo")){
        if (row["Name"].includes("Ordinary")){
            row["Name"] = "Ordinary Keldeo";
            idStr = idStr + "-ordinary";
        }
        else if (row["Name"].includes("Resolute")){
            row["Name"] = "Resolute Keldeo";
            idStr = idStr + "-resolute";
        }
    }
    else if (row["Name"].includes("Meloetta")){
        if (row["Name"].includes("Pirouette")){
            row["Name"] = "Meloetta (Pirouette)";
            idStr = idStr + "-pirouette";
        }
        else{
            row["Name"] = "Meloetta (Aria)";
        }
    }
    else if (row["Name"].includes("Aegislash")){
        if (row["Name"].includes("Blade")){
            idStr = idStr + "-blade";
            row["Name"] = "Aegislash (Blade)";
        }
        else{
            idStr = idStr + "-shield";
            row["Name"] = "Aegislash (Shield)";
        }
    }
    else if (row["Name"].includes("HoopaHoopa")){
        if (row["Name"].includes("Unbound")){
            idStr = idStr + "-unbound";
        }
    }
    return {
        id: Number(row["#"]),
        idStr: idStr,
        gen: Number(row["Generation"]),
        legend: l,
        name: row["Name"],
        type1 : row["Type 1"],
        type2: row["Type 2"],
        attack: Number(row["Attack"]),
        defense: Number(row["Defense"]),
        sp_attack: Number(row["Sp. Atk"]),
        sp_defense: Number(row["Sp. Def"]),
        hp: Number(row["HP"]),
        speed: Number(row["Speed"]),
        total: Number(row["Total"]),
        attackTot: Math.max(Number(row["Attack"]), Number(row["Sp. Atk"])),
        defTot: (Number(row["Defense"])+Number(row["Sp. Def"])+Number(row["HP"]))/3,
        mega: isMega
    };
}

function parseTypeChart(row){
    row2 = {};
    for (var i in row){
        if (row[i] == ""){
            row2[i] = 1;
        }
        else{
            row2[i] = Number(row[i]);
        }
    }
    return row2;
}

function parseMoves(row){
    var gen;
    if (row.Gen === "I"){
        gen = 1;
    }
    else if (row.Gen === "II"){
        gen = 2;
    }
    else if (row.Gen === "III"){
        gen = 3;
    }
    else if (row.Gen === "IV"){
        gen = 4;
    }
    else if (row.Gen == "V"){
        gen  = 5;
    }
    else{
        gen = 6;
    }
    if (row.Power === ""){
        return null;
    }
    var accuracy;
    if (row.Accuracy === "")
        accuracy = 1;
    else{
        accuracy = Number(row.Accuracy);
    }
    return {"id": Number(row.ID),
            "name": row.Name,
            "type": row.Type,
            "attack_type": row.Attack_Type,
            "contest_type": row.Contest_Type,
            "gen" : gen,
            "power" : Number(row.Power),
            "pp" : Number(row.PP),
            "accuracy" : accuracy
    };
}

// Asynchronous load just in case we use more data files
d3.queue()
.defer(d3.csv, "Pokemon.csv", parseStatsRow)
.defer(d3.csv, "pokemon_type_chart.csv", parseTypeChart)
.defer(d3.csv, "moves.csv", parseMoves)
.await(function (error, pokemon_data, type_chart, moves_table) {
    for (i = 0; i < typeLst.length; i++){
        typeToEff[typeLst[i]] = type_chart[i];
        typeToMoves[typeLst[i]] = [];
    }
    for (i = 0; i < moves_table.length; i++){
        typeToMoves[moves_table[i]["type"]].push(moves_table[i]);
    }
    for (i = 0; i < pokemon_data.length; i++){
        pokemon = pokemon_data[i];
        total.push(pokemon);
        atk.push(pokemon);
        def.push(pokemon);
        if (pokemon.gen == 1){
            total1.push(pokemon); atk1.push(pokemon); def1.push(pokemon);
        }
        if (pokemon.gen == 2){
            total2.push(pokemon); atk2.push(pokemon); def2.push(pokemon);
        }
        if (pokemon.gen == 3){
            total3.push(pokemon); atk3.push(pokemon); def3.push(pokemon);
        }
        if (pokemon.gen == 4){
            total4.push(pokemon); atk4.push(pokemon); def4.push(pokemon);
        }
        if (pokemon.gen == 5){
            total5.push(pokemon); atk5.push(pokemon); def5.push(pokemon);
        }
        if (pokemon.gen == 6){
            total6.push(pokemon); atk6.push(pokemon); def6.push(pokemon);
        }
    }
    total.sort(function(a, b) {return parseFloat(b.total) - parseFloat(a.total);});
    total1.sort(function(a, b) {return parseFloat(b.total) - parseFloat(a.total);});
    total2.sort(function(a, b) {return parseFloat(b.total) - parseFloat(a.total);});
    total3.sort(function(a, b) {return parseFloat(b.total) - parseFloat(a.total);});
    total4.sort(function(a, b) {return parseFloat(b.total) - parseFloat(a.total);});
    total5.sort(function(a, b) {return parseFloat(b.total) - parseFloat(a.total);});
    total6.sort(function(a, b) {return parseFloat(b.total) - parseFloat(a.total);});

    atk.sort(function(a, b) {return parseFloat(b.attackTot) - parseFloat(a.attackTot);});
    atk1.sort(function(a, b) {return parseFloat(b.attackTot) - parseFloat(a.attackTot);});
    atk2.sort(function(a, b) {return parseFloat(b.attackTot) - parseFloat(a.attackTot);});
    atk3.sort(function(a, b) {return parseFloat(b.attackTot) - parseFloat(a.attackTot);});
    atk4.sort(function(a, b) {return parseFloat(b.attackTot) - parseFloat(a.attackTot);});
    atk5.sort(function(a, b) {return parseFloat(b.attackTot) - parseFloat(a.attackTot);});
    atk6.sort(function(a, b) {return parseFloat(b.attackTot) - parseFloat(a.attackTot);});

    def.sort(function(a, b) {return parseFloat(b.defTot) - parseFloat(a.defTot);});
    def1.sort(function(a, b) {return parseFloat(b.defTot) - parseFloat(a.defTot);});
    def2.sort(function(a, b) {return parseFloat(b.defTot) - parseFloat(a.defTot);});
    def3.sort(function(a, b) {return parseFloat(b.defTot) - parseFloat(a.defTot);});
    def4.sort(function(a, b) {return parseFloat(b.defTot) - parseFloat(a.defTot);});
    def5.sort(function(a, b) {return parseFloat(b.defTot) - parseFloat(a.defTot);});
    def6.sort(function(a, b) {return parseFloat(b.defTot) - parseFloat(a.defTot);});

    displayPokemon(); // first chart
    plotTypePercentages(); // second chart
    plotTeamTypeChart(); // third chart
    plotMoves(); // fourth chart
});


/*
 * Function is called right after data loads or whenever form is submitted.
 * Deals with getting 6 team members and ranked list of alternate team members. 
 */
function displayPokemon(){
    var svg = d3.select("#pokemon_images").selectAll("svg");
    svg.selectAll("*").remove(); // removes images from before
    teamData = makeTeam(); // re-makes the team
    if (teamType == "total"){
        team = teamData.total;
        nextTeam = teamData.totalNext;
    }
    else if (teamType == "attack"){
        team = teamData.atk;
        nextTeam = teamData.atkNext;
    }
    else if (teamType == "defense"){
        team = teamData.def;
        nextTeam = teamData.defNext;
    }
    else if (teamType == "mixed"){
        team = teamData.total.concat(teamData.atk);
        team = team.concat(teamData.def);
        nextAttack = teamData.atkNext;
        nextDef = teamData.defNext;
        nextTotal = teamData.totalNext;
        
    }
    else if (teamType == "random"){
        var fullTeam = shuffleArray(teamData.total.concat(teamData.totalNext));
        nextTeam = fullTeam.splice(6,fullTeam.length);
        team = fullTeam;
    }

    if (teamType == "mixed"){
        svg.append("rect")
            .attr("x", 25)
            .attr("y", 20)
            .attr("fill", "green")
            .attr("opacity", 0.2)
            .attr("height", 200)
            .attr("width", 420);
        svg.append("rect")
            .attr("x", 25+220*2)
            .attr("y", 20)
            .attr("fill", "red")
            .attr("opacity", 0.2)
            .attr("height", 200)
            .attr("width", 420);
        svg.append("rect")
            .attr("x", 25+220*4)
            .attr("y", 20)
            .attr("fill", "blue")
            .attr("opacity", 0.2)
            .attr("height", 200)
            .attr("width", 420);
        svg.append("text")
            .text("Highest Stat Total")
            .attr("x", 230)
            .attr("y", 245)
            .style("font-size", "17px")
            .style("font-weight","bold")
            .attr("fill", "green")
            .attr("text-anchor","middle");
        svg.append("text")
            .text("Best Attackers")
            .attr("x", 230+2*220)
            .attr("y", 245)
            .style("font-size", "17px")
            .style("font-weight","bold")
            .attr("fill", "red")
            .attr("text-anchor","middle");
        svg.append("text")
            .text("Defensive Walls")
            .attr("x", 230+4*220)
            .attr("y", 245)
            .style("font-size", "17px")
            .style("font-weight","bold")
            .attr("fill", "blue")
            .attr("text-anchor","middle");
    }
    // appending images to svg
    idUsed = [];
    for (i = 0; i < 6; i++){
        idUsed.push(team[i].idStr);
        svg.append("image")
            .attr("id","team_pic_"+i)
            .attr("class", "team_pic")
            .attr("x", 25+i*220)
            .attr("y", 20)
            .attr("height", 200)
            .attr("width", 200)
            .attr("href", "pokemon_pics/" + team[i].idStr + ".png")
            .attr("xlink:href", "pokemon_pics/" + team[i].idStr + ".png");
    }

    // appending stat text
    for (i = 0; i < 6; i++){
        appendStats(i, svg);
    }

    var button_width = 50;
    var button_height = 25;
    // appending button to switch pokemon
    for (i = 0; i < 6; i++){
        svg.append("rect")
            .attr("class", "switch_button")
            .attr("x", i*220+125-button_width/2)
            .attr("y", 200+button_height+5)
            .attr("rx", 8)
            .attr("ry", 8)
            .attr("height", button_height)
            .attr("width", button_width)
            .attr("fill", "#3D9970")
            .attr("onclick", "onSwitch("+i+")");
        svg.append("text")
            .text("Switch")
            .attr("pointer-events", "none")
            .attr("x", i*220+125-button_width/2+3)
            .attr("y", 200+button_height+button_height/2+10)
            .style("fill", "white")
            .style("cursor", "default")
            .attr("onclick", "onSwitch("+i+")");
    }
}

function appendStats(i, svg){
    svg.append("rect")
        .attr("id","team_stat_"+i)
        .attr("class", "team_stat")
        .attr("x", 25+i*220)
        .attr("y", 20)
        .attr("height", 200)
        .attr("width", 200)
        .attr("fill", "white")
        .attr("opacity", 0);
    // pokemon name
    svg.append("text")
        .attr("id", "team_stat_text_"+i)
        .attr("class", "team_stat_text")
        .text(team[i].name)
        .attr("x", 25+i*220+100)
        .attr("y", 45)
        .style("font-size", "17px")
        .style("font-weight","bold")
        .attr("opacity",0)
        .attr("pointer-events", "none")
        .attr("text-anchor","middle")
        .attr("fill", "black");

    // type of Pokemon
    if (team[i].type2 == ""){
        svg.append("rect")
            .attr("id","team_stat_text_"+i)
            .attr("class", "team_stat_text")
            .attr("pointer-events", "none")
            .attr("opacity", 0)
            .attr("x", 25+i*220+45+10)
            .attr("y", 55)
            .attr("rx", 5)
            .attr("ry", 5)
            .attr("height", 20)
            .attr("width", 90)
            .attr("fill", typeToColor[team[i].type1]);
        svg.append("text")
            .attr("id", "team_stat_text_"+i)
            .attr("class", "team_stat_text")
            .attr("pointer-events", "none")
            .text(team[i].type1)
            .attr("x", 25+i*220+100)
            .attr("y", 70)
            .attr("opacity",0)
            .attr("text-anchor","middle")
            .attr("fill", "white");
    }
    else{
        svg.append("rect")
            .attr("id","team_stat_text_"+i)
            .attr("class", "team_stat_text")
            .attr("pointer-events", "none")
            .attr("opacity", 0)
            .attr("x", 25+i*220+10)
            .attr("y", 55)
            .attr("rx", 5)
            .attr("ry", 5)
            .attr("height", 20)
            .attr("width", 85)
            .attr("fill", typeToColor[team[i].type1]);
        svg.append("rect")
            .attr("id","team_stat_text_"+i)
            .attr("class", "team_stat_text")
            .attr("pointer-events", "none")
            .attr("opacity", 0)
            .attr("x", 25+i*220+110)
            .attr("y", 55)
            .attr("rx", 5)
            .attr("ry", 5)
            .attr("height", 20)
            .attr("width", 85)
            .attr("fill", typeToColor[team[i].type2]);
        svg.append("text")
            .attr("id", "team_stat_text_"+i)
            .attr("class", "team_stat_text")
            .attr("pointer-events", "none")
            .text(team[i].type1)
            .attr("x", 25+i*220+50)
            .attr("y", 70)
            .attr("opacity",0)
            .attr("text-anchor","middle")
            .attr("fill", "white");
        svg.append("text")
            .attr("id", "team_stat_text_"+i)
            .attr("class", "team_stat_text")
            .attr("pointer-events", "none")
            .text(team[i].type2)
            .attr("x", 25+i*220+150)
            .attr("y", 70)
            .attr("opacity",0)
            .attr("text-anchor","middle")
            .attr("fill", "white");
    }
    for (j = 0; j < 7; j++){
        var field = ""; var fieldU = "";
        if (j == 0) {field = "hp"; fieldU = "HP:";}
        if (j == 1) {field = "attack"; fieldU = "Attack:";}
        if (j == 2) {field = "defense"; fieldU = "Defense:";}
        if (j == 3) {field = "sp_attack"; fieldU = "Sp. Attack:";}
        if (j == 4) {field = "sp_defense"; fieldU = "Sp. Defense:";}
        if (j == 5) {field = "speed"; fieldU = "Speed:";}
        if (j == 6) {field = "total"; fieldU = "Total:";}
        svg.append("text")
            .attr("id", "team_stat_text_"+i)
            .attr("class", "team_stat_text")
            .attr("pointer-events", "none")
            .text(fieldU)
            .attr("x", 25+i*220+30)
            .attr("y", 95+j*20)
            .attr("opacity",0)
            .attr("text-anchor","start")
            .attr("fill", "black");
        svg.append("text")
            .attr("id", "team_stat_text_"+i)
            .attr("class", "team_stat_text")
            .attr("pointer-events", "none")
            .text(team[i][field])
            .attr("x", 25+i*220+120)
            .attr("y", 95+j*20)
            .attr("opacity",0)
            .attr("text-anchor","start")
            .attr("fill", "black");
    }
}

/*
 * Switches pokemon at the id to the next one in line
 */
function onSwitch(id){
    var svg = d3.select("#pokemon_images").selectAll("svg");
    if (teamType == "total" || teamType == "random" || teamType == "attack" || teamType == "defense"){
        if (nextTeam.length == 0){
            window.alert("You went through every Pokemon that fits your search criteria...");
            return;
        }
        team[id] = nextTeam.shift();
    }
    else{
        if (id < 2){
            if (nextTotal.length == 0){
                window.alert("You went through every Pokemon that fits your search criteria...");
                return;
            }
            var nextPokemon = nextTotal.shift();
            while (idUsed.indexOf(nextPokemon.idStr)>=0){
                if (nextTotal.length == 0){
                    window.alert("You went through every Pokemon that fits your search criteria...");
                    return;
                }
                nextPokemon = nextTotal.shift();
            }
        }
        else if (id < 4){
            if (nextAttack.length == 0){
                window.alert("You went through every Pokemon that fits your search criteria...");
                return;
            }
            var nextPokemon = nextAttack.shift();
            while (idUsed.indexOf(nextPokemon.idStr)>=0){
                if (nextAttack.length == 0){
                    window.alert("You went through every Pokemon that fits your search criteria...");
                    return;
                }
                nextPokemon = nextAttack.shift();
            }
        }
        else{
            if (nextDef.length == 0){
                window.alert("You went through every Pokemon that fits your search criteria...");
                return;
            }
            var nextPokemon = nextDef.shift();
            while (idUsed.indexOf(nextPokemon.idStr)>=0){
                if (nextDef.length == 0){
                    window.alert("You went through every Pokemon that fits your search criteria...");
                    return;
                }
                nextPokemon = nextDef.shift();
            }
        }
        idUsed.push(nextPokemon.idStr);
        team[id] = nextPokemon;
    }
    var pokemon_pic = d3.select("#team_pic_"+id);
    pokemon_pic.remove();
    var pokemon_stats = d3.selectAll("#team_stat_"+id);
    pokemon_stats.remove();
    svg.append("image")
        .attr("id","team_pic_"+id)
        .attr("class", "team_pic")
        .attr("x", 25+id*220)
        .attr("y", 20)
        .attr("height", 200)
        .attr("width", 200)
        .attr("href", "pokemon_pics/" + team[id].idStr + ".png")
        .attr("xlink:href", "pokemon_pics/" + team[id].idStr + ".png");
    appendStats(id, svg);
    plotTypePercentages();
    plotTeamTypeChart();
    plotMoves();
}

/*
 * Taken from : http://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
 */
function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    return array;
}

function makeTeam(){
    var teamData = {
        total : [],
        totalNext: [],
        atk : [],
        atkNext: [],
        def : [],
        defNext : []
    };
    if (teamType == "total" || teamType == "random"){
        teamData.total = criteriaSearch(total);
        teamData.totalNext = teamData.total.splice(6,teamData.total.length);
    }
    if (teamType == "attack"){
        teamData.atk = criteriaSearch(atk);
        teamData.atkNext = teamData.atk.splice(6,teamData.atk.length);
    }
    if (teamType == "defense"){
        teamData.def = criteriaSearch(def);
        teamData.defNext = teamData.def.splice(6,teamData.def.length);
    }
    if (teamType == "mixed"){
        teamData.total = criteriaSearch(total);
        teamData.totalNext = teamData.total.splice(2,teamData.total.length);
        var idlst = [teamData.total[0].idStr, teamData.total[1].idStr];
        var tempAttack = criteriaSearch(atk);
        var nextAttack = tempAttack.shift();
        while (idlst.indexOf(nextAttack.idStr)>=0){
            nextAttack = tempAttack.shift();
        }
        teamData.atk.push(nextAttack);
        idlst.push(nextAttack.idStr)
        nextAttack = tempAttack.shift();
        while (idlst.indexOf(nextAttack.idStr)>=0){
            nextAttack = tempAttack.shift();
        }
        teamData.atk.push(nextAttack);
        idlst.push(nextAttack.idStr)
        teamData.atkNext = tempAttack;

        var tempDef = criteriaSearch(def);
        nextDef = tempDef.shift();
        while (idlst.indexOf(nextDef.idStr)>=0){
            nextDef = tempDef.shift();
        }
        teamData.def.push(nextDef);
        idlst.push(nextDef.idStr)
        nextDef = tempDef.shift();
        while (idlst.indexOf(nextDef.idStr)>=0){
            nextDef = tempDef.shift();
        }
        teamData.def.push(nextDef);
        teamData.defNext = tempDef;
    }
    return teamData;
}

function criteriaSearch(lst){
    inRegionPokemon = [];
    for (i = 0; i < lst.length; i++){
        var pokemon = lst[i];
        if (regions[pokemon.gen-1]){
            if (!pokemon.legend || legend){
                if (!pokemon.mega || mega){
                    inRegionPokemon.push(pokemon);
                }
            }
        }
    }
    return inRegionPokemon;
}

/*
 * Takes form as input, checks validity of form inputs, if everything 
 * works then function to display top Pokemon is called. 
 */
function submitForm(){
    var form = document.getElementById("mainForm");
    var countChecked = 0;
    var regionsUpdate = [];
    var legendUpdate = true;
    var megaUpdate = true;
    if (form.Legend.value == "no"){
        legendUpdate = false;
    }
    if (form.Mega.value == "no"){
        megaUpdate = false;
    }
    var teamTypeUpdate = form.Team.value;
    for (i = 0; i < 6; i++) {
        countChecked += form.Gen[i].checked;
        regionsUpdate[i] = form.Gen[i].checked;
    }
    if (countChecked == 0){
        window.alert("You need to check at least one region!");
    }
    else{
        regions = regionsUpdate;
        teamType = teamTypeUpdate;
        legend = legendUpdate;
        mega = megaUpdate;
        displayPokemon();
        plotTypePercentages();
        plotTeamTypeChart();
        plotMoves();
    }
}

function submitForm2(){
    var form = document.getElementById("form2");
    if (form.R.value == "all"){
        // do computation with everything (default)
        useAllRegionsType = true;
    }
    else{
        // do computation with just selected regions
        useAllRegionsType = false;
    }
    plotTypePercentages();
    plotTeamTypeChart();
    plotMoves();
}

// Used https://bl.ocks.org/alandunning/7008d0332cc28a826b37b3cf6e7bd998 as reference
function plotTypePercentages(){
    var svg = d3.select("#type_counts");
    svg.selectAll("*").remove(); // removes plot from before

    for (i = 0; i < typeLst.length; i++){
        data[i] = {"name": typeLst[i], "value": 0, "color": typeToColor[typeLst[i]]};
    }
    for (i = 0; i<total.length; i++){
        var pokemon = total[i];
        if (useAllRegionsType || regions[pokemon.gen-1]){
            data[regionToIdx[pokemon.type1]].value+=1;
            if (pokemon.type2!=""){
                data[regionToIdx[pokemon.type2]].value+=1;
            }
        }
    }
    data = data.sort(function (a, b) {return d3.ascending(a.value, b.value);});

    var margin = {top: 50, right: 20, bottom: 20, left: 80},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.bottom;
  
    var xScale = d3.scaleLinear().range([margin.left, width]).domain([0,d3.max(data, function(d){return d.value;})]);
    var yScale = d3.scaleBand().range([height, margin.top]).padding(0.1).domain(data.map(function(d) { return d.name; }));
    var tooltip = d3.select("body").append("div").attr("class", "toolTip");

    svg.append("text")
        .text("Counts of Each Type of Pokemon")
        .attr("x", margin.left + width/2)
        .attr("y", 35)
        .attr("text-anchor","middle")
        .attr("fill", "black");
    svg.selectAll(".bar")
        .data(data)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("width", function(d) {return xScale(d.value); } )
        .attr("y", function(d) { return yScale(d.name); })
        .attr("x", margin.left)
        .attr("fill", function(d) {return d.color})
        .attr("height", yScale.bandwidth())
        .on("mousemove", function(d){
            tooltip
              .style("left", d3.event.pageX +10  + "px")
              .style("top", d3.event.pageY -30 + "px")
              .style("display", "inline-block")
              .html((d.name) + ": "+ (d.value));
        })
            .on("mouseout", function(d){ tooltip.style("display", "none");});;

    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(xScale));
    svg.append("g")
        .attr("transform", "translate("+margin.left+",0)")
        .call(d3.axisLeft(yScale));
}



function plotTeamTypeChart(){

    var svg = d3.select("#team_type_chart");
    svg.selectAll("*").remove(); // removes plot from before (keep this)

    document.getElementById("offensebutton").style.background = "gray";
    document.getElementById("defensebutton").style.background = "#3D9970";

    xMargin = 150;
    yMargin = 50;
    squareSides = 50;
    var mostCommonTypes = [].concat(data).reverse(); //non-destructive reverse
    var tooltip = d3.select("body").append("div").attr("class", "toolTip");

    mostCommonTypes.forEach(function(t, i){
    	team.forEach(function(p, j){
    		svg.append("rect")
            .attr("class", "map_rect")
            .attr("id", j+t.name)
	    	.attr("x",i*squareSides+xMargin)
	    	.attr("y", j*squareSides+yMargin)
	    	.attr("width", squareSides)
	    	.attr("height", squareSides)
	    	.style("fill", function(d){
	    		if (p.type2){
                    newdict = {};
                    newdict[t.name] = typeToEff[p.type1][t.name]*typeToEff[p.type2][t.name];
                    if (teamToDamage[p.name]){
                        teamToDamage[p.name]= Object.assign(teamToDamage[p.name], newdict);
                    }
                    else{
                        teamToDamage[p.name] = newdict;
                    }
	    			return colorDict[teamToDamage[p.name][t.name]];
	    		}
	    		else{
                    newdict = {};
                    newdict[t.name] = typeToEff[p.type1][t.name];
                    if (teamToDamage[p.name]){
                        teamToDamage[p.name]= Object.assign(teamToDamage[p.name], newdict);
                    }
                    else{
                        teamToDamage[p.name] = newdict;
                    }
	    			return colorDict[teamToDamage[p.name][t.name]];
	    		}
	    	})
	    	.style("stroke", "black")
            .on("mousemove", function(d){
            tooltip
              .style("left", d3.event.pageX +10  + "px")
              .style("top", d3.event.pageY -30 + "px")
              .style("display", "inline-block")
              .html((p.name) + ": "+ teamToDamage[p.name][t.name])
            })
            .on("mouseout", function(d){ tooltip.style("display", "none");});
    	});
    	svg.append("text")
    	.attr("x", 0)
        .attr("text-anchor", "middle")
    	.attr("y", 0)
    	.text(t.name)
        .attr("fill", typeToColor[t.name])
        .attr("transform", "translate(" + (i*squareSides+xMargin+30) + ", 30) rotate(-40)");
    });

    team.forEach(function(p, j){
    	svg.append("text")
    	.attr("x",0)
    	.attr("y", j*squareSides+80)
    	.text(p.name);
    });

    var gradient = svg.append("defs")
    .append("linearGradient")
    .attr("id", "gradient")
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "100%")
    .attr("spreadMethod", "pad");

    gradient.append("stop")
    .attr("offset", "0%")
    .attr("stop-color", "#ffffff")
    .attr("stop-opacity", 1);

    gradient.append("stop")
    .attr("offset", "100%")
    .attr("stop-color", "#1C8901")
    .attr("stop-opacity", 1);

    svg.append("rect")
    .attr("width", 510)
    .attr("height", 10)
    .attr("x",400)
    .attr("y" ,360)
    .style("fill", "url(#gradient)");

    ["0", "0.25", "0.5", "1", "2", "4"].forEach(function(d,i){
        svg.append("text")
        .text(d)
        .attr("x", i*100)
        .attr("y", 0)
        .attr("transform", "translate(400, 380)");
    });

}

function buttonClickDef(){
    document.getElementById("defensebutton").style.background = "gray";
    document.getElementById("offensebutton").style.background = "#3D9970";
    var svg = d3.select("#team_type_chart");
    var tooltip = d3.select("body").append("div").attr("class", "toolTip");
    var rects = svg.selectAll(".map_rect");
    
    rects.on("mousemove", function(d){
            p = team[parseInt(this.getAttribute("id"))];
            t = this.getAttribute("id").substring(1);
            tooltip
              .style("left", d3.event.pageX +10  + "px")
              .style("top", d3.event.pageY -30 + "px")
              .style("display", "inline-block")
              .html(function(z){
                return (p.name) + ": "+ teamToWeakness[p.name][t];
                });
            })
            .on("mouseout", function(d){ tooltip.style("display", "none");});

    rects.transition().duration(750)
    .style("fill", function(d){
        p = team[parseInt(this.getAttribute("id"))];
        t = this.getAttribute("id").substring(1);

        if (p.type2){
            newdict = {};
            newdict[t] = typeToEff[t][p.type1]*typeToEff[t][p.type2];
            if (teamToWeakness[p.name]){
                teamToWeakness[p.name]= Object.assign(teamToWeakness[p.name], newdict);
            }
            else{
                teamToWeakness[p.name] = newdict;
            }
            return colorDictDef[teamToWeakness[p.name][t]];
        }
        else{
            newdict = {};
            newdict[t] = typeToEff[t][p.type1];
            if (teamToWeakness[p.name]){
                teamToWeakness[p.name]= Object.assign(teamToWeakness[p.name], newdict);
            }
            else{
                teamToWeakness[p.name] = newdict;
            }
            return colorDictDef[teamToWeakness[p.name][t]];
        }
    });
    gradient = svg.select("#gradient");

    gradient.selectAll("stop").remove();

    gradient.append("stop")
    .attr("offset", "0%")
    .attr("stop-color", "#ffffff")
    .attr("stop-opacity", 1);

    gradient.append("stop")
    .attr("offset", "100%")
    .attr("stop-color", "#BF000D")
    .attr("stop-opacity", 1);

}

function buttonClickOff(){
    document.getElementById("offensebutton").style.background = "gray";
    document.getElementById("defensebutton").style.background = "#3D9970";
    var tooltip = d3.select("body").append("div").attr("class", "toolTip");
    var svg = d3.select("#team_type_chart");
    var rects = svg.selectAll(".map_rect");

    rects.on("mousemove", function(d){
        p = team[parseInt(this.getAttribute("id"))];
        t = this.getAttribute("id").substring(1);
            tooltip
              .style("left", d3.event.pageX +10  + "px")
              .style("top", d3.event.pageY -30 + "px")
              .style("display", "inline-block")
              .html((p.name) + ": "+ teamToDamage[p.name][t])
            })
            .on("mouseout", function(d){ tooltip.style("display", "none");});

    rects.transition().duration(750)
    .style("fill", function(d){
        p = team[parseInt(this.getAttribute("id"))];
        t = this.getAttribute("id").substring(1);
        return colorDict[teamToDamage[p.name][t]];
        })

    gradient = svg.select("#gradient");
    gradient.selectAll("stop").remove();

    gradient.append("stop")
    .attr("offset", "0%")
    .attr("stop-color", "#ffffff")
    .attr("stop-opacity", 1);

    gradient.append("stop")
    .attr("offset", "100%")
    .attr("stop-color", "#1C8901")
    .attr("stop-opacity", 1);
    
}

function plotMoves(){
    // currently called in most of the right places (need to add call for when we change from offense to defense)
    var svg = d3.select("#recommended_moves");
    svg.selectAll("*").remove(); // removes plot from before (keep this)

    svg.append("rect") // just to make sure plotting works
        .attr("x", 50)
        .attr("y", 50)
        .attr("fill", "black")
        .attr("height", 10)
        .attr("width",10);
    // To find code where the type button code is (just images not clickable) search for "type of Pokemon"
    // All relevant move data is in typeToMoves
    var button_width = 75;
    var button_height = 25;
    //var yscale_plotmoves = d3.scaleLinear().domain([0, 17]).range([100, 900]);

    typeLst.forEach(function(t,i){
        svg.append("rect")
            .attr("class", "switch_button")
            .attr("x", 50)
            .attr("y", i*50 +50)
            .attr("rx", 8)
            .attr("ry", 8)
            .attr("height", button_height)
            .attr("width", button_width)
            .attr("fill", "#3D9970")
            .attr("onclick", "onSwitch("+i+")");
        svg.append("text")
            .text(t)
            .attr("pointer-events", "none")
            .attr("x", 53)
            .attr("y", i*50 +68)
            .style("fill", "white")
            .style("cursor", "default")
            .attr("onclick", "onSwitch("+i+")");
    })
}
</script>


</body>
</html>